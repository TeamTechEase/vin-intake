<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Diminished Value VIN Intake</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body { font-family: Arial, sans-serif; background:#f4f6f8; margin:0; padding:20px; }
.container { max-width:1200px; margin:auto; background:#fff; padding:20px; border-radius:8px; }
h2 { margin-top:30px; }
label { display:block; margin-top:12px; font-weight:bold; }
input { width:100%; padding:8px; margin-top:4px; }
.row { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
.status { margin-top:8px; font-size:13px; }
.report { margin-top:30px; padding:20px; border:1px solid #ccc; }
.report h3 { margin-top:0; }
hr { margin:20px 0; }
</style>
</head>

<body>
<div class="container">

<h2>Enter Vehicle VIN Number</h2>
<label>VIN</label>
<input id="vinInput" maxlength="17" placeholder="Paste 17-character VIN" />
<div id="vinStatus" class="status"></div>

<h2>Vehicle Information</h2>
<div class="row">
  <div>
    <label>Year</label>
    <input id="vehicleYear" />
  </div>
  <div>
    <label>Make</label>
    <input id="vehicleMake" />
  </div>
  <div>
    <label>Model</label>
    <input id="vehicleModel" />
  </div>
  <div>
    <label>Trim</label>
    <input id="vehicleTrim" />
  </div>
</div>

<label style="margin-top:15px;">VIN (copied)</label>
<input id="vehicleVIN" />

<hr>

<h2>Report Preview</h2>
<div class="report">
  <h3>Vehicle Identification</h3>
  <p><strong>Year:</strong> <span id="rYear">—</span></p>
  <p><strong>Make:</strong> <span id="rMake">—</span></p>
  <p><strong>Model:</strong> <span id="rModel">—</span></p>
  <p><strong>Trim:</strong> <span id="rTrim">—</span></p>
  <p><strong>VIN:</strong> <span id="rVIN">—</span></p>
</div>

</div>

<script>
(() => {
  const $ = id => document.getElementById(id);

  function setVal(el, val) {
    if (!el) return;
    el.value = val || "";
    el.dispatchEvent(new Event("input", { bubbles:true }));
  }

  function setText(id, val) {
    const el = $(id);
    if (el) el.textContent = val || "—";
  }

  function normalizeVIN(v) {
    return v.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,17);
  }

  async function decodeVIN(vin) {
    if (vin.length < 11) {
      $("vinStatus").textContent = "Enter at least 11 characters.";
      return;
    }

    $("vinStatus").textContent = "Decoding VIN…";

    try {
      const res = await fetch(
        `https://vpic.nhtsa.dot.gov/api/vehicles/decodevinvaluesextended/${vin}?format=json`
      );
      const data = await res.json();
      const r = data.Results[0];

      setVal($("vehicleVIN"), vin);
      setVal($("vehicleYear"), r.ModelYear);
      setVal($("vehicleMake"), r.Make);
      setVal($("vehicleModel"), r.Model);
      setVal($("vehicleTrim"), r.Trim || r.Series);

      setText("rVIN", vin);
      setText("rYear", r.ModelYear);
      setText("rMake", r.Make);
      setText("rModel", r.Model);
      setText("rTrim", r.Trim || r.Series);

      $("vinStatus").textContent = "VIN decoded successfully.";
    } catch (e) {
      console.error(e);
      $("vinStatus").textContent = "VIN decode failed. Check console.";
    }
  }

  let timer;
  $("vinInput").addEventListener("input", e => {
    const vin = normalizeVIN(e.target.value);
    e.target.value = vin;
    setVal($("vehicleVIN"), vin);
    clearTimeout(timer);
    timer = setTimeout(() => decodeVIN(vin), 400);
  });
})();
</script>

</body>
</html>
